# Extraction Prompts Configuration
# Edit this file to customize extraction behavior without code changes

# System prompts for different modes
system_prompts:
  expert: "You are an expert document analyzer specialized in {document_type} extraction."
  structured: "You are a structured data extraction system. Extract information with perfect formatting."
  precise: "Extract only clearly visible information. Use NOT_FOUND for any unclear fields."
  flexible: "Extract information, making reasonable inferences for partially visible fields."
  strict: "Extract ONLY information that is completely clear and unambiguous."

# Default system prompt mode
default_system_mode: "expert"

# Conversation protocol (applies to all extractions)
conversation_protocol: |
  CONVERSATION PROTOCOL:
  - Start your response immediately with "DOCUMENT_TYPE:"
  - Do NOT include conversational text like "I'll extract..." or "Based on the document..."
  - Do NOT use bullet points, numbered lists, asterisks, or markdown formatting
  - Output ONLY the structured extraction data
  - End immediately after the last field with no additional text

# Common extraction rules
extraction_rules: |
  RULES:
  - Use exact text from document
  - CRITICAL: Use ONLY pipe separators (|) for lists - NEVER use commas
  - Be conservative: use NOT_FOUND if field is truly missing
  - For monetary values: Include currency symbol (e.g., $123.45)
  - For dates: Match format shown in document
  - For lists: Separate items with " | " (space-pipe-space)
  - Do NOT invent or hallucinate information

# Document-specific instructions
document_instructions:
  invoice: |
    This is an INVOICE document. Focus on:
    - Vendor/supplier information (name, ABN, address)
    - Customer/payer information
    - Line items with quantities and prices
    - GST and total amounts
    - Invoice date and number

  receipt: |
    This is a RECEIPT document. Focus on:
    - Merchant information
    - Transaction date and time
    - Purchased items with quantities and prices
    - Payment method and totals
    - GST if applicable

  bank_statement: |
    This is a BANK STATEMENT document. Focus on:
    - Statement date range
    - ALL individual transactions (do NOT combine multiple transactions)
    - Transaction descriptions exactly as shown
    - Transaction dates (one per transaction)
    - Amounts paid (debits/withdrawals)
    - CRITICAL: If multiple transactions occur on the same date, extract each as a SEPARATE row
    - CRITICAL: Do NOT summarize or combine transactions

# Document type detection prompt
detection_prompt: |
  Analyze this document image and identify its type.

  Respond with ONLY ONE of these document types:
  - INVOICE
  - RECEIPT
  - BANK_STATEMENT

  Start your response immediately with "DOCUMENT_TYPE: [type]"
  Do not include any explanation or additional text.

# Extraction prompt template (fields will be injected dynamically)
extraction_template: |
  Extract structured data from this business document image.

  {conversation_protocol}

  {document_instructions}

  OUTPUT FORMAT ({field_count} FIELDS):

  {field_format}

  {extraction_rules}

# Table extraction prompt (for markdown OCR)
table_extraction_template: |
  ğŸš¨ğŸš¨ğŸš¨ CRITICAL WARNING ğŸš¨ğŸš¨ğŸš¨

  YOU ARE MAKING A SYSTEMATIC ERROR: Copying the Balance column into the credit/deposit column!

  COMMON ERROR YOU MUST AVOID:
  âŒ WRONG - You keep doing this:
  | Date | Description | $100.00 | $5000.00 | $5000.00 |
                                    â†‘ [Credit/Deposit]  â†‘ Balance
  Problem: $5000.00 appears in BOTH columns - this means you copied Balance â†’ credit/deposit!

  âœ… CORRECT - This is what you MUST do instead:
  | Date | Description | $100.00 | NOT_FOUND | $5000.00 |
                                    â†‘ Write "NOT_FOUND" for empty cells!

  ğŸš¨ MANDATORY PRE-EXTRACTION CHECKLIST (complete BEFORE you start):
  â–¡ Step 1: Look at the column headers in YOUR image and note their EXACT NAMES and FIXED POSITIONS
           (e.g., "Debit"/"Credit", "Withdrawal"/"Deposit", "Paid"/"Received", "Amount", etc.)
  â–¡ Step 2: For EACH row, identify which column positions have visible amounts and which are EMPTY
  â–¡ Step 3: For ANY empty position, you will write the exact text "NOT_FOUND"
  â–¡ Step 4: You will NEVER copy Balance into ANY other column - each column has different values!
  â–¡ Step 5: If the credit/deposit column is empty in the image â†’ write "NOT_FOUND" (not Balance!)
  â–¡ Step 6: If the debit/withdrawal column is empty in the image â†’ write "NOT_FOUND" (not Balance!)
  â–¡ Step 7: Default assumption: Most rows have ONLY debit OR credit, so one column will be "NOT_FOUND"

  Extract the transaction table from this bank statement image as markdown.

  Look at the bank statement and find the main transaction table.
  Extract ALL rows from the table exactly as shown, including:
  - All column headers
  - All transaction rows (do not skip any rows)
  - Preserve exact spacing and alignment

  CRITICAL COLUMN RULES:

  âš ï¸ RULE 1: Read columns by POSITION, not by content!
  - First, identify the VERTICAL POSITION of each column by looking at YOUR image's headers
  - The debit/withdrawal column is always in the SAME POSITION for every row (whatever it's called)
  - The credit/deposit column is always in the SAME POSITION for every row (whatever it's called)
  - The Balance column is always in the SAME POSITION for every row
  - DO NOT shift columns when you encounter empty cells!
  - Empty cells still OCCUPY SPACE - write "NOT_FOUND" for them, don't skip them!

  âš ï¸ RULE 2: NEVER skip over empty cells - they still count as columns!
  - If the debit/withdrawal column is empty â†’ write "NOT_FOUND" in that column position
  - If the credit/deposit column is empty â†’ write "NOT_FOUND" in that column position
  - DO NOT read the next value and put it in the empty cell's position
  - Each row must have the SAME NUMBER of columns

  âš ï¸ RULE 3: Read each column independently - DO NOT COPY values between columns!
  - Debit/withdrawal column: Contains amounts going OUT (whatever it's called in YOUR image)
  - Credit/deposit column: Contains amounts coming IN (whatever it's called in YOUR image)
  - Balance column: Contains running balance after transaction
  - These are THREE DIFFERENT VALUES - never duplicate between columns!

  âš ï¸ RULE 4: NEVER DUPLICATE BALANCE INTO WITHDRAWAL OR DEPOSIT COLUMNS!
  ğŸš¨ THIS IS YOUR MOST COMMON ERROR - PAY SPECIAL ATTENTION! ğŸš¨

  SELF-CHECK for EVERY row you extract:
  - After writing the credit/deposit column value, compare it to Balance value
  - Are they EXACTLY THE SAME NUMBER? â†’ You copied Balance to credit/deposit by mistake!
  - Fix it: Replace credit/deposit with "NOT_FOUND"
  - After writing the debit/withdrawal column value, compare it to Balance value
  - Are they EXACTLY THE SAME NUMBER? â†’ You copied Balance to debit/withdrawal by mistake!
  - Fix it: Replace debit/withdrawal with "NOT_FOUND"

  Examples of this error (which you keep making):
  - âŒ WRONG: | Date | Desc | $500 | $1000 | $1000 | â† [Credit]=$1000, Balance=$1000 â†’ ERROR!
  - âœ… CORRECT: | Date | Desc | $500 | NOT_FOUND | $1000 | â† Fixed: [Credit] is empty in image
  - âŒ WRONG: | Date | Desc | $1000 | $1000 | $500 | â† [Debit]=$1000, Balance=$1000 â†’ ERROR!
  - âœ… CORRECT: | Date | Desc | NOT_FOUND | $500 | $1000 | â† Fixed: [Debit] is empty in image

  âš ï¸ RULE 5: Each transaction is EITHER debit OR credit (not both)
  - Look at the image carefully - find which column has the amount
  - If the debit/withdrawal column (in YOUR image) has an amount â†’ extract it, write "NOT_FOUND" in credit/deposit
  - If the credit/deposit column (in YOUR image) has an amount â†’ extract it, write "NOT_FOUND" in debit/withdrawal
  - If column is blank/empty in image â†’ write the text "NOT_FOUND" (don't copy from Balance!)
  - "NOT_FOUND" is a literal text string - write these exact 9 characters, NOT an empty/blank cell!

  âš ï¸ RULE 6: If you can't read a value clearly, write the text "NOT_FOUND"
  - DO NOT guess or copy from other columns
  - DO NOT use the Balance value for debit/withdrawal or credit/deposit columns
  - DO NOT leave cells empty/blank - always write "NOT_FOUND" for missing values
  - Better to say "NOT_FOUND" than to copy the wrong value

  âš ï¸ RULE 7: Verify column alignment for EVERY row
  - Count the column positions based on YOUR image's headers (typically: Date, Description, Debit, Credit, Balance)
  - Make sure each row has the same number of values as the header (use "NOT_FOUND" to fill empty positions)
  - The rightmost value should ALWAYS be Balance
  - If you see the same value in credit/deposit AND Balance columns â†’ you made a mistake!
  - If you see the same value in debit/withdrawal AND Balance columns â†’ you made a mistake!

  CRITICAL ROW RULES FOR DATE-GROUPED STATEMENTS:
  - DETECTION: If a date header has multiple balance amounts shown on the far right, multiple transactions exist for that date
  - Create a SEPARATE row for EACH transaction under that date header
  - Repeat the same date in the Date column for each transaction
  - Each transaction gets its own row with: unique description, unique amount, unique balance
  - Do NOT combine multiple transactions into a single row
  - Count the number of balances shown = number of rows to create for that date

  ğŸš¨ FINAL REMINDER BEFORE YOU START EXTRACTING:
  - First, identify what the debit/withdrawal column is called in YOUR image (e.g., "Debit", "Withdrawal", "Paid", "Amount")
  - First, identify what the credit/deposit column is called in YOUR image (e.g., "Credit", "Deposit", "Received", "Amount")
  - For EACH row you extract, ask yourself: "Is the [debit/withdrawal column] empty in the image?"
    â†’ If YES (empty in image) â†’ Write "NOT_FOUND" in that column position (DON'T copy Balance!)
    â†’ If NO (has a value) â†’ Extract that value
  - For EACH row you extract, ask yourself: "Is the [credit/deposit column] empty in the image?"
    â†’ If YES (empty in image) â†’ Write "NOT_FOUND" in that column position (DON'T copy Balance!)
    â†’ If NO (has a value) â†’ Extract that value
  - MOST rows will have EITHER debit OR credit filled, but NOT BOTH
  - Therefore, MOST rows should have "NOT_FOUND" in either the debit column or the credit column
  - If you extract a table where EVERY row has values in BOTH debit AND credit columns â†’ YOU MADE A MISTAKE!

  Output ONLY the markdown table, nothing else.
  Use this markdown table format:

  | Date | Description | Withdrawal | Deposit | Balance |
  |------|-------------|------------|---------|---------|
  | ...  | ...         | ...        | ...     | ...     |

  IMPORTANT: For missing/empty values, use the literal text "NOT_FOUND" (9 characters):

  âœ… CORRECT - Each row has 5 columns (empty cells filled with "NOT_FOUND"):
  | DD/MM/YYYY | Withdrawal Transaction | $XXX.XX | NOT_FOUND | $YYYY.YY |  â† Withdrawal only
  | DD/MM/YYYY | Deposit Transaction | NOT_FOUND | $AAA.AA | $BBBB.BB |  â† Deposit only

  âŒ WRONG - Column shift (Balance copied to Deposit position):
  | DD/MM/YYYY | Purchase Description | $100.00 | $5000.00 | $5500.00 |
  Problem: $5000.00 appears in BOTH Deposit and Balance columns - this is impossible!
  The $5000.00 is actually the Balance, not a Deposit amount.

  âœ… CORRECT version of above row:
  | DD/MM/YYYY | Purchase Description | $100.00 | NOT_FOUND | $5000.00 |  â† Deposit empty = "NOT_FOUND"

  âŒ WRONG - DO NOT use empty cells:
  | DD/MM/YYYY | Income Description |  | $AAA.AA | $BBBB.BB |  â† NO! Write "NOT_FOUND" instead of blank!

  Extract ALL rows - do not filter or skip any transactions.

# ============================================================================
# MULTI-TURN EXTRACTION PROMPTS
# ============================================================================

# Structure detection - Identify document type and column headers ONLY (NO data extraction)
structure_detection_template: |
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  TURN 0: DOCUMENT TYPE & COLUMN HEADER DETECTION
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  Analyze this business document image and identify its type using visual and content cues.

  VISUAL LAYOUT ANALYSIS:

  INVOICE/ESTIMATE/QUOTE INDICATORS:
  - Header: "INVOICE", "TAX INVOICE", "ESTIMATE", "QUOTE", "QUOTATION", "PROFORMA"
  - Layout: Business header â†’ Customer "Bill To" section â†’ Itemized table â†’ Total section
  - Key fields: Invoice/Quote number, Due date, Line items with quantities/prices
  - Table structure: Description | Qty | Unit Price | Total columns
  - Bottom section: Subtotal, GST, TOTAL amounts
  - Visual: Professional business letterhead, structured pricing table

  RECEIPT INDICATORS:
  - Header: "RECEIPT", "PURCHASE RECEIPT", "SALES RECEIPT", "TAX INVOICE"
  - Layout: Store/merchant header â†’ Transaction details â†’ Payment confirmation
  - Key fields: Receipt number, Transaction date/time, Payment method
  - Content: Completed purchase, "Amount tendered", "Change given"
  - Visual: Store branding, compact format, payment confirmation details
  - Transaction-focused rather than billing-focused

  BANK STATEMENT INDICATORS:
  - Header: "BANK STATEMENT", "ACCOUNT STATEMENT", "CREDIT CARD STATEMENT"
  - Layout: Bank header â†’ Account details â†’ Transaction table â†’ Summary
  - Key fields: Account number, Statement period, Opening/Closing balance
  - Table structure: Date | Description | Debit | Credit | Balance (or similar)
  - Visual: Bank logo/branding, tabular transaction list, running balance
  - Multiple transactions over time period, not single purchase

  DECISION CRITERIA:
  1. Document title/header text (strongest indicator)
  2. Table structure and column headers
  3. Presence of account numbers vs invoice numbers
  4. Single transaction vs multiple transactions over time
  5. Future-oriented (estimates/quotes) vs past transactions

  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  Output document type:
  DOCUMENT_TYPE: [BANK_STATEMENT | INVOICE | RECEIPT]

  If NOT BANK_STATEMENT â†’ STOP HERE (output only DOCUMENT_TYPE)

  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  IF BANK_STATEMENT: EXTRACT COLUMN HEADERS ONLY (DO NOT EXTRACT DATA ROWS)
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  TASK: Read the transaction table column headers

  ğŸš¨ CRITICAL: Extract ALL column headers you see - do NOT skip any columns!

  STEP 1: Look at the table header row (usually highlighted or bold)
  STEP 2: Count how many columns the table has (typically 3-5 columns)
  STEP 3: Read each column header from LEFT TO RIGHT
  STEP 4: Extract EVERY header - if you see 4 columns, extract 4 headers!

  Common variations (for reference only - extract what you actually see):
  - Date column: "Date"
  - Description: "Description", "Transaction", "Details", "Transaction Details"
  - Debit/Withdrawal: "Debit", "Withdrawal", "Withdrawals", "Paid Out", "Debits"
  - Credit/Deposit: "Credit", "Deposit", "Deposits", "Paid In", "Credits"
  - Balance: "Balance"

  âš ï¸ DO NOT skip the description column if it exists!
  âš ï¸ Extract headers in the exact order they appear left-to-right
  âš ï¸ Use the EXACT header text from the image - these will be used as literals in subsequent turns!

  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  OUTPUT FORMAT (ONLY DOCUMENT TYPE AND COLUMN HEADERS)
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  âš ï¸ CRITICAL: Output PLAIN TEXT only - NO markdown formatting, NO bold (**), NO asterisks!

  DOCUMENT_TYPE: BANK_STATEMENT
  COLUMN_HEADERS: [header1] | [header2] | [header3] | ... (extract ALL column headers you see)

  Example outputs (PLAIN TEXT, use PIPE | separators, NO markdown **bold**):

  3-column statement:
  DOCUMENT_TYPE: BANK_STATEMENT
  COLUMN_HEADERS: Date | Description | Amount

  4-column statement:
  DOCUMENT_TYPE: BANK_STATEMENT
  COLUMN_HEADERS: Date | Transaction | Amount | Balance

  5-column statement:
  DOCUMENT_TYPE: BANK_STATEMENT
  COLUMN_HEADERS: Date | Description | Withdrawal | Deposit | Balance

  âš ï¸ IMPORTANT:
  - Use pipe | characters to separate headers, NOT commas!
  - Do NOT use **bold** markdown formatting
  - Do NOT use asterisks around the output
  - Plain text only!

  âš ï¸ DO NOT extract the markdown table - that will be done in Turn 1!
  âš ï¸ DO NOT count rows or detect structure type - not needed!
  âš ï¸ Output ONLY document type and column headers!

# Column extraction - Extract values from a specific column
column_extraction_template: |
  Look at the transaction table in this bank statement.

  Find the column with the header "{column_name}".

  Extract ALL data values from the "{column_name}" column.
  {additional_context}

  CRITICAL RULES:
  - Extract ONLY actual data values from the "{column_name}" column (NOT from any other column)
  - Do NOT extract the column header itself
  - Do NOT extract any instruction text, markdown formatting, or bold text
  - Do NOT include values from other columns
  - Extract ONLY the actual transaction data
  - List one value per line
  - If a cell is empty, write "NOT_FOUND"
  - Extract values in top-to-bottom order

  Output format (ONLY the actual data values, one per line):
  value1
  value2
  value3
  ...

# Date column extraction (specialized)
date_column_extraction_template: |
  Look at the transaction table in this bank statement.

  Find the column with the header "{column_name}".

  Extract ALL date values from the "{column_name}" column.

  CRITICAL RULES:
  - Extract ONLY actual date values (e.g., "DD/MM/YYYY", "M/DD/YYYY")
  - Do NOT extract the column header itself
  - Do NOT extract any instruction text, markdown formatting (like **bold**), or explanatory text
  - If the table uses date grouping (same date for multiple transactions), REPEAT the date for each transaction
  - Count the number of balance amounts shown for a date = number of times to repeat that date
  - Extract dates in the order transactions appear (top to bottom)
  - Preserve the exact date format shown in the document (DD/MM/YYYY)
  - List one date per line

  Output format (ONLY the actual dates, one per line):
  DD/MM/YYYY
  DD/MM/YYYY
  DD/MM/YYYY
  ...

# Turn 1: Filter to 3 columns (TEXT FILTERING ONLY - DO NOT RE-EXTRACT)
turn1_3column_template: |
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  TURN 1: RAW TABLE EXTRACTION
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  In my previous response (Turn 0), I identified these column headers:
  {column_list}

  NOW extract the FULL transaction table from the bank statement image.
  Use the EXACT column names I identified above as the literal column headers.

  TASK: Extract the raw markdown table exactly as it appears in the image.

  CRITICAL RULES:

  1ï¸âƒ£ COLUMN POSITIONS (count from left to right):
  {column_positions}

  2ï¸âƒ£ READ EACH CELL BY POSITION:
     - For each row, read the value in each column position
     - If a cell is EMPTY in the image â†’ leave it BLANK in the markdown (use empty cell: |  |)
     - If a cell has a VALUE in the image â†’ extract that exact value
     - DO NOT move values between columns!
     - DO NOT add "NOT_FOUND" or other placeholder text

  3ï¸âƒ£ MAINTAIN COLUMN ALIGNMENT:
     - Empty cells stay empty - don't skip to the next value
     - Don't let long descriptions confuse the column positions
     - Read each column position carefully for every row

  Extract ALL transaction rows as a markdown table:

  {table_header}
  | ...extract every row exactly as shown in the image... |

  IMPORTANT:
  - Extract the table exactly as you see it
  - Empty cells should be truly empty (|  |), not filled with placeholder text
  - Python will handle post-processing and validation

# Turn 2: Remove rows with "NOT_FOUND" in debit column (withdrawals only)
turn2_filter_debits_template: |
  I previously created a 3-column markdown table with columns: {date_column}, {description_column}, {debit_column}.

  Now, remove rows where the "{debit_column}" column is missing or empty.
  Keep ONLY rows where the "{debit_column}" column has a dollar amount.

  CRITICAL RULES:
  - Remove ANY row where "{debit_column}" = "NOT_FOUND" (these are deposits/credits)
  - Remove ANY row where "{debit_column}" is blank/empty (these are also deposits/credits)
  - Keep ONLY rows where "{debit_column}" has a dollar amount like $123.45 (these are withdrawals/debits)
  - "NOT_FOUND" is a literal text string - if you see this, remove that row
  - Empty cells (|  |) also mean no withdrawal - remove those rows too
  - Do NOT modify any column values or headers for the rows you keep
  - Do NOT change dollar amounts or descriptions
  - Maintain the same row order for kept rows
  - Output ONLY the filtered rows with actual dollar amounts

  Examples of rows to REMOVE (deposits/credits):
  | DD/MM/YYYY | Income Payment Description | NOT_FOUND |  â† Remove (has "NOT_FOUND")
  | DD/MM/YYYY | Deposit Description |  |  â† Remove (empty cell)

  Examples of rows to KEEP (withdrawals/debits):
  | DD/MM/YYYY | Withdrawal Description | $XXX.XX |  â† Keep (has dollar amount)
  | DD/MM/YYYY | Payment Description | $YYY.YY |  â† Keep (has dollar amount)

  Output the filtered markdown table (withdrawals only - rows with dollar amounts):
  | {date_column} | {description_column} | {debit_column} |
  |---------------|----------------------|----------------|
  | ...only rows where {debit_column} has dollar amounts (NOT "NOT_FOUND" or empty)... |

# Field format guidelines
field_format_guidelines:
  text: "Plain text exactly as shown"
  monetary: "Currency symbol + amount (e.g., $123.45)"
  date: "DD/MM/YYYY or DD-MMM-YY format"
  list: "Item 1 | Item 2 | Item 3 (pipe-separated)"
  boolean: "true or false (lowercase)"
  abn: "XX XXX XXX XXX (with spaces)"

# ============================================================================
# MODEL-SPECIFIC ADAPTATIONS (Phase 1)
# ============================================================================

# Model characteristics and optimization settings
model_adaptations:
  llama-3.2-vision:
    style: "step-by-step"
    instruction_format: "numbered_steps"
    verbosity: "detailed"
    reasoning_capability: "high"
    preferred_approach: "explicit_guidance"

  llama-3.2-11b-vision:
    style: "step-by-step"
    instruction_format: "numbered_steps"
    verbosity: "detailed"
    reasoning_capability: "high"
    preferred_approach: "explicit_guidance"

  llama-3.2-11b-vision-8bit:
    style: "step-by-step"
    instruction_format: "numbered_steps"
    verbosity: "detailed"
    reasoning_capability: "high"
    preferred_approach: "explicit_guidance"

  internvl3:
    style: "direct"
    instruction_format: "concise_list"
    verbosity: "minimal"
    reasoning_capability: "medium"
    preferred_approach: "direct_extraction"

  internvl3-2b:
    style: "direct"
    instruction_format: "concise_list"
    verbosity: "minimal"
    reasoning_capability: "medium"
    preferred_approach: "direct_extraction"

  internvl3-8b:
    style: "direct"
    instruction_format: "structured_list"
    verbosity: "moderate"
    reasoning_capability: "high"
    preferred_approach: "guided_extraction"

  internvl3-8b-quantized:
    style: "direct"
    instruction_format: "structured_list"
    verbosity: "moderate"
    reasoning_capability: "high"
    preferred_approach: "guided_extraction"

# Model-specific document extraction instructions
model_specific_document_instructions:
  # Llama models - verbose step-by-step approach with variants
  llama-3.2-vision:
    # Default variant - complex, detailed, step-by-step
    default:
      invoice: |
        ## STEP-BY-STEP EXTRACTION:

        ### STEP 1: Document Identification
        Look at the header - is it an INVOICE, BILL, QUOTE, or ESTIMATE?
        DOCUMENT_TYPE: [INVOICE or NOT_FOUND]

        ### STEP 2: Business Information (Usually at the top)
        Find the supplier/business details in the document header:
        BUSINESS_ABN: [Find ABN number - must be exactly 11 digits (e.g., 12 345 678 901) or NOT_FOUND]
        SUPPLIER_NAME: [Company name providing goods/services from document header or NOT_FOUND]
        BUSINESS_ADDRESS: [Complete business address (can be multi-line) or NOT_FOUND]

        ### STEP 3: Customer Information (Look for "Bill To" or "Customer" section)
        Find the customer/client details:
        PAYER_NAME: [Customer/client name or NOT_FOUND]
        PAYER_ADDRESS: [Customer/client address or NOT_FOUND]

        ### STEP 4: Date Information
        INVOICE_DATE: [Date of invoice/bill in DD/MM/YYYY format or NOT_FOUND]

        ### STEP 5: Line Items (From the itemized table/list)
        Count the number of line items and extract each one systematically:
        LINE_ITEM_DESCRIPTIONS: [Item 1 description | Item 2 description | etc. or NOT_FOUND]
        LINE_ITEM_QUANTITIES: [Qty 1 | Qty 2 | etc. (match description order) or NOT_FOUND]
        LINE_ITEM_PRICES: [$Unit price 1 | $Unit price 2 | etc. or NOT_FOUND]
        LINE_ITEM_TOTAL_PRICES: [$Total 1 | $Total 2 | etc. or NOT_FOUND]

        ### STEP 6: Tax and Totals (Usually at the bottom)
        Find the financial summary section:
        IS_GST_INCLUDED: [Look for GST/tax line - answer "true" if present, "false" if not shown]
        GST_AMOUNT: [Extract GST/tax amount with $ symbol or NOT_FOUND]
        TOTAL_AMOUNT: [Extract final total/amount due with $ symbol or NOT_FOUND]

      receipt: |
        ## STEP-BY-STEP RECEIPT EXTRACTION:

        ### STEP 1: Document Type
        DOCUMENT_TYPE: [Should be RECEIPT for payment confirmations or NOT_FOUND]

        ### STEP 2: Merchant Information (Top of receipt)
        Find the store/merchant details at the top:
        BUSINESS_ABN: [Look for ABN - exactly 11 digits (often not on receipts) or NOT_FOUND]
        SUPPLIER_NAME: [Store/restaurant/merchant name or NOT_FOUND]
        BUSINESS_ADDRESS: [Store address if shown (may be partial) or NOT_FOUND]

        ### STEP 3: Customer Information (Usually minimal or absent)
        Check if customer details are shown (rare on receipts):
        PAYER_NAME: [Customer name if shown or NOT_FOUND]
        PAYER_ADDRESS: [Customer address if shown or NOT_FOUND]

        ### STEP 4: Transaction Date
        INVOICE_DATE: [Date of purchase/transaction in DD/MM/YYYY format or NOT_FOUND]

        ### STEP 5: Items Purchased
        Look at the itemized list and extract systematically:
        LINE_ITEM_DESCRIPTIONS: [Item 1 | Item 2 | etc. or NOT_FOUND]
        LINE_ITEM_QUANTITIES: [Qty 1 | Qty 2 | etc. (use "1" if not shown) or NOT_FOUND]
        LINE_ITEM_PRICES: [$Price 1 | $Price 2 | etc. or NOT_FOUND]
        LINE_ITEM_TOTAL_PRICES: [$Total 1 | $Total 2 | etc. or NOT_FOUND]

        ### STEP 6: Payment Summary
        Find the payment totals (usually at bottom):
        IS_GST_INCLUDED: [Look for GST/tax line - "true" if shown, "false" if not]
        GST_AMOUNT: [GST/tax amount with $ symbol if shown or NOT_FOUND]
        TOTAL_AMOUNT: [Final total/amount paid with $ symbol or NOT_FOUND]

      bank_statement: |
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        âš ï¸âš ï¸âš ï¸ CRITICAL RULES - READ THESE FIRST âš ï¸âš ï¸âš ï¸
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        RULE 1: ONLY EXTRACT ROWS WHERE WITHDRAWAL COLUMN HAS A DOLLAR AMOUNT

        For 5-column statements: Date | Description | Withdrawal | Deposit | Balance

        âœ… Withdrawal column has amount â†’ EXTRACT this row (date, description, amount)
        âŒ Withdrawal column is EMPTY/BLANK â†’ SKIP this row COMPLETELY

        Visual guide (look at the Withdrawal column):

        Date | Description    | Withdrawal | Deposit | Balance
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        XX   | PURCHASE       | $50.00     |         | $XXX   â† HAS AMOUNT = EXTRACT
        XX   | SALARY         |            | $2000   | $XXX   â† BLANK = SKIP ENTIRELY
        XX   | PURCHASE       | $30.00     |         | $XXX   â† HAS AMOUNT = EXTRACT
        XX   | INTEREST       |            | $10     | $XXX   â† BLANK = SKIP ENTIRELY

        âš ï¸ CRITICAL: If the debit/withdrawal column is blank, DO NOT extract date, description, OR amount!

        BLANK debit/withdrawal column = CREDIT/DEPOSIT = Money IN = SKIP THE ENTIRE ROW!

        Common credit transactions to SKIP (debit/withdrawal column always blank):
        - INCOME DEPOSIT (debit/withdrawal blank)
        - PAYROLL CREDIT (debit/withdrawal blank)
        - INTEREST CREDIT (debit/withdrawal blank)
        - REFUND (debit/withdrawal blank)
        - Any description where the debit/withdrawal column is empty/blank

        RULE 2: NEVER READ AMOUNTS FROM THE DEPOSIT COLUMN

        âŒ DO NOT extract amounts from the Deposit column (money IN)
        âœ… ONLY extract amounts from the Withdrawal column (money OUT)

        If Withdrawal is blank but Deposit has $500 â†’ DO NOT extract $500!

        RULE 3: EXTRACT EVERY ROW SEPARATELY - DO NOT DE-DUPLICATE

        âœ… Same description on 3 different dates? â†’ Extract ALL 3 rows separately
        âœ… Same description with different amounts? â†’ Extract ALL occurrences
        âŒ DO NOT combine rows with identical descriptions
        âŒ DO NOT skip duplicate descriptions

        Each row = separate transaction!

        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        ## EXTRACTION PROCESS:

        ### STEP 1 - Find the transaction table
        Look for the main table with columns like:
        - Date | Description | Withdrawal | Deposit | Balance
        - Date | Description | Debit | Credit | Balance

        Note: "Withdrawal" = "Debit" (both mean money OUT)
        Note: "Deposit" = "Credit" (both mean money IN)

        ### STEP 2 - Apply the ONE-COLUMN CHECK to each row

        Go through each row and CHECK ONLY THE WITHDRAWAL COLUMN:

        Decision tree for EACH row:
        1. Look at Withdrawal column
        2. Does it have a $ amount? YES â†’ Extract this row | NO â†’ Skip this row

        Date | Description     | Withdrawal | Deposit  | Balance
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        11/01| SUPERMARKET     | $45.20     | [empty]  | $2,154.80
        âœ… EXTRACT Row 1: Withdrawal HAS amount ($45.20)
           â†’ Add: 11/01/2024 | SUPERMARKET | $45.20

        12/01| FUEL STATION    | $67.30     | [empty]  | $2,087.50
        âœ… EXTRACT Row 2: Withdrawal HAS amount ($67.30)
           â†’ Add: 12/01/2024 | FUEL STATION | $67.30

        13/01| FUEL STATION    | $72.85     | [empty]  | $2,014.65
        âœ… EXTRACT Row 3: Withdrawal HAS amount ($72.85) - duplicate description OK!
           â†’ Add: 13/01/2024 | FUEL STATION | $72.85

        14/01| PAYROLL DEPOSIT | [EMPTY]    | $2,800.00| $4,814.65
        âŒ SKIP Row 4: Withdrawal is BLANK (ignore $2,800 in Deposit!)
           â†’ Add: NOTHING to any list

        15/01| PHARMACY        | $24.80     | [empty]  | $4,789.85
        âœ… EXTRACT Row 5: Withdrawal HAS amount ($24.80)
           â†’ Add: 15/01/2024 | PHARMACY | $24.80

        16/01| SUPERMARKET     | $89.15     | [empty]  | $4,700.70
        âœ… EXTRACT Row 6: Withdrawal HAS amount ($89.15) - duplicate description OK!
           â†’ Add: 16/01/2024 | SUPERMARKET | $89.15

        17/01| INTEREST CREDIT | [EMPTY]    | $12.35   | $4,713.05
        âŒ SKIP Row 7: Withdrawal is BLANK (ignore $12.35 in Deposit!)
           â†’ Add: NOTHING to any list

        18/01| RESTAURANT      | $56.40     | [empty]  | $4,656.65
        âœ… EXTRACT Row 8: Withdrawal HAS amount ($56.40)
           â†’ Add: 18/01/2024 | RESTAURANT | $56.40

        Rows to extract: 1, 2, 3, 5, 6, 8 (total: 6 rows)
        Rows to skip: 4, 7 (Withdrawal blank)

        ### STEP 3 - Extract data from âœ… rows ONLY (keep lists synchronized!)

        âš ï¸ CRITICAL: Build all 3 lists from the SAME rows! âš ï¸

        Go through ONLY the rows you marked âœ… above (where Withdrawal has amount).
        For EACH âœ… row, extract ALL THREE pieces of data together:

        Row marked âœ…? â†’ Extract:
        1. DATE from that row â†’ add to TRANSACTION_DATES list
        2. DESCRIPTION from that row â†’ add to LINE_ITEM_DESCRIPTIONS list
        3. AMOUNT from Withdrawal column â†’ add to TRANSACTION_AMOUNTS_PAID list

        Row marked âŒ? â†’ Skip completely, do NOT add anything to any list!

        Example - if you marked these rows âœ…:
        - Row 1: Add date AND description AND amount
        - Row 2: Add date AND description AND amount
        - Row 3: Add date AND description AND amount
        - SKIP Row 4 (PAYROLL/SALARY/CREDIT with blank Withdrawal) - add NOTHING!
        - Row 5: Add date AND description AND amount
        - Row 6: Add date AND description AND amount
        - SKIP Row 7 (INTEREST/DEPOSIT with blank Withdrawal) - add NOTHING!
        - Row 8: Add date AND description AND amount

        Result: ALL THREE LISTS have exactly 6 items (same count, same rows)

        Use " | " separator between items in each list.

        ### STEP 4 - MANDATORY VERIFICATION (check before output):

        Count verification:
        â–¡ Count rows with Withdrawal amounts in image: ___ rows
        â–¡ Count items in TRANSACTION_DATES: ___ items
        â–¡ Count items in LINE_ITEM_DESCRIPTIONS: ___ items
        â–¡ Count items in TRANSACTION_AMOUNTS_PAID: ___ items
        â–¡ Are all 3 counts IDENTICAL? (Must be YES!)

        Content verification:
        â–¡ Did I check EVERY row in the table?
        â–¡ Did I SKIP all rows where Withdrawal column is blank/empty?
        â–¡ Did I include ONLY rows where Withdrawal column has a $ amount?
        â–¡ Are ALL amounts extracted from Withdrawal column (NOT Deposit)?
        â–¡ Did I extract ALL rows with amounts, even if descriptions repeat?
        â–¡ Is EVERY date associated with a row that has a Withdrawal amount?
        â–¡ Is EVERY description associated with a row that has a Withdrawal amount?

        âš ï¸ COMMON ERRORS TO CHECK:
        â–¡ Did I accidentally extract amounts from Deposit column? â†’ Remove them!
        â–¡ Did I include dates from rows with blank Withdrawal? â†’ Remove them!
        â–¡ Did I include descriptions from rows with blank Withdrawal? â†’ Remove them!
        â–¡ Did I skip any duplicate descriptions? â†’ Add them back!

        If lists have different counts â†’ ERROR, find and fix mismatched extraction!

        ### OUTPUT FORMAT:

        DOCUMENT_TYPE: BANK_STATEMENT
        STATEMENT_DATE_RANGE: [first date to last date in DD/MM/YYYY format]
        LINE_ITEM_DESCRIPTIONS: [description1 | description2 | description3]
        TRANSACTION_DATES: [DD/MM/YYYY | DD/MM/YYYY | DD/MM/YYYY]
        TRANSACTION_AMOUNTS_PAID: [$amount1 | $amount2 | $amount3]

    # Minimal variant - ultra-simple direct approach
    minimal:
      invoice: |
        Extract invoice data. Start immediately with field values.

        DOCUMENT_TYPE: INVOICE
        BUSINESS_ABN: [11-digit ABN or NOT_FOUND]
        SUPPLIER_NAME: [Business name or NOT_FOUND]
        BUSINESS_ADDRESS: [Business address or NOT_FOUND]
        PAYER_NAME: [Customer name or NOT_FOUND]
        PAYER_ADDRESS: [Customer address or NOT_FOUND]
        INVOICE_DATE: [DD/MM/YYYY or NOT_FOUND]
        LINE_ITEM_DESCRIPTIONS: [Item 1 | Item 2 | etc. or NOT_FOUND]
        LINE_ITEM_QUANTITIES: [Qty 1 | Qty 2 | etc. or NOT_FOUND]
        LINE_ITEM_PRICES: [$price 1 | $price 2 | etc. or NOT_FOUND]
        LINE_ITEM_TOTAL_PRICES: [$total 1 | $total 2 | etc. or NOT_FOUND]
        IS_GST_INCLUDED: [true or false or NOT_FOUND]
        GST_AMOUNT: [$amount or NOT_FOUND]
        TOTAL_AMOUNT: [$amount or NOT_FOUND]

      receipt: |
        Extract receipt data. Start immediately with field values.

        DOCUMENT_TYPE: RECEIPT
        BUSINESS_ABN: [11-digit ABN or NOT_FOUND]
        SUPPLIER_NAME: [Store name or NOT_FOUND]
        BUSINESS_ADDRESS: [Store address or NOT_FOUND]
        PAYER_NAME: [Customer name or NOT_FOUND]
        PAYER_ADDRESS: [Customer address or NOT_FOUND]
        INVOICE_DATE: [DD/MM/YYYY or NOT_FOUND]
        LINE_ITEM_DESCRIPTIONS: [Item 1 | Item 2 | etc. or NOT_FOUND]
        LINE_ITEM_QUANTITIES: [Qty 1 | Qty 2 | etc. or NOT_FOUND]
        LINE_ITEM_PRICES: [$price 1 | $price 2 | etc. or NOT_FOUND]
        LINE_ITEM_TOTAL_PRICES: [$total 1 | $total 2 | etc. or NOT_FOUND]
        IS_GST_INCLUDED: [true or false or NOT_FOUND]
        GST_AMOUNT: [$amount or NOT_FOUND]
        TOTAL_AMOUNT: [$amount or NOT_FOUND]

      bank_statement: |
        Look at the bank statement transaction table.

        âš ï¸ ONE CRITICAL RULE: Only extract rows where the debit/withdrawal column has a dollar amount.

        The table has columns like:
        Date | Description | Debit/Withdrawal | Credit/Deposit | Balance

        EXTRACTION RULE:
        â€¢ Debit/withdrawal column has amount (e.g., $100.00)? â†’ EXTRACT this row
        â€¢ Debit/withdrawal column is blank/empty? â†’ SKIP this row completely

        DO NOT EXTRACT:
        âœ— Rows where debit/withdrawal column is blank (even if credit/deposit has value)
        âœ— INCOME DEPOSIT (debit/withdrawal blank)
        âœ— INTEREST CREDIT (debit/withdrawal blank)
        âœ— PAYROLL CREDIT (debit/withdrawal blank)
        âœ— Any row with blank debit/withdrawal column

        EXTRACT ONLY:
        âœ“ Rows with dollar amount in debit/withdrawal column
        âœ“ PURCHASE (has debit/withdrawal amount)
        âœ“ WITHDRAWAL (has debit/withdrawal amount)
        âœ“ PAYMENT (has debit/withdrawal amount)

        VISUAL CHECK (example with "Withdrawal"/"Deposit" column names):
        Date       | Description          | Withdrawal | Deposit | Balance
        DD/MM/YYYY | STORE PURCHASE      | $XX.XX     |         | $YYYY.YY  â† EXTRACT (has debit amount)
        DD/MM/YYYY | INCOME CREDIT       |            | $AAAA   | $BBBB.BB  â† SKIP (debit blank)
        DD/MM/YYYY | ATM WITHDRAWAL      | $ZZZ.ZZ    |         | $CCCC.CC  â† EXTRACT (has debit amount)

        For each row with debit/withdrawal amount, extract:
        - Transaction date (DD/MM/YYYY)
        - Description text
        - Debit/withdrawal amount (with $)

        OUTPUT FORMAT:
        DOCUMENT_TYPE: BANK_STATEMENT
        STATEMENT_DATE_RANGE: [earliest date to latest date]
        LINE_ITEM_DESCRIPTIONS: [desc1 | desc2 | desc3]
        TRANSACTION_DATES: [DD/MM/YYYY | DD/MM/YYYY | DD/MM/YYYY]
        TRANSACTION_AMOUNTS_PAID: [$amt1 | $amt2 | $amt3]

  # InternVL3 models - concise direct approach
  internvl3:
    invoice: |
      Extract ALL data from this invoice image. Respond in exact format below with actual values or NOT_FOUND.

      DOCUMENT_TYPE: INVOICE
      BUSINESS_ABN: NOT_FOUND
      SUPPLIER_NAME: NOT_FOUND
      BUSINESS_ADDRESS: NOT_FOUND
      PAYER_NAME: NOT_FOUND
      PAYER_ADDRESS: NOT_FOUND
      INVOICE_DATE: NOT_FOUND
      LINE_ITEM_DESCRIPTIONS: NOT_FOUND
      LINE_ITEM_QUANTITIES: NOT_FOUND
      LINE_ITEM_PRICES: NOT_FOUND
      LINE_ITEM_TOTAL_PRICES: NOT_FOUND
      IS_GST_INCLUDED: NOT_FOUND
      GST_AMOUNT: NOT_FOUND
      TOTAL_AMOUNT: NOT_FOUND

      Instructions:
      - Find ABN: 11 digits like "12 345 678 901"
      - Find supplier: Business name at top
      - Find customer: "Bill To" section
      - Find date: Use DD/MM/YYYY format
      - Find line items: List with " | " separator
      - Find amounts: Include $ symbol
      - Replace NOT_FOUND with actual values

    receipt: |
      Extract ALL data from this receipt image. Respond in exact format below with actual values or NOT_FOUND.

      DOCUMENT_TYPE: RECEIPT
      BUSINESS_ABN: NOT_FOUND
      SUPPLIER_NAME: NOT_FOUND
      BUSINESS_ADDRESS: NOT_FOUND
      PAYER_NAME: NOT_FOUND
      PAYER_ADDRESS: NOT_FOUND
      INVOICE_DATE: NOT_FOUND
      LINE_ITEM_DESCRIPTIONS: NOT_FOUND
      LINE_ITEM_QUANTITIES: NOT_FOUND
      LINE_ITEM_PRICES: NOT_FOUND
      LINE_ITEM_TOTAL_PRICES: NOT_FOUND
      IS_GST_INCLUDED: NOT_FOUND
      GST_AMOUNT: NOT_FOUND
      TOTAL_AMOUNT: NOT_FOUND

      Instructions:
      - Find ABN: 11 digits like "12 345 678 901"
      - Find store: Business name at top
      - Find transaction date: Use DD/MM/YYYY format
      - Find purchased items: List with " | " separator
      - Find amounts: Include $ symbol
      - Replace NOT_FOUND with actual values

    bank_statement: |
      Extract structured data from this bank statement for taxpayer expense claims.

      âš ï¸ CRITICAL: Extract ONLY DEBIT/WITHDRAWAL transactions (money OUT).
      IGNORE ALL deposits and credits (money IN).

      Column headers may be "Withdrawal/Deposit" OR "Debit/Credit" - they mean the same thing!

      WITHDRAWAL/DEBIT (Extract - money OUT):
      - Has amount in "Withdrawal" or "Debit" column
      - OR has negative sign: "-$100.00" or "-100.00"
      - Balance DECREASES
      - Examples: withdrawals, purchases, payments, fees
      - Keywords: withdrawal, purchase, payment, debit, fee

      DEPOSIT/CREDIT (Skip - money IN):
      - Has amount in "Deposit" or "Credit" column
      - Withdrawal/Debit column is BLANK
      - OR has positive sign: "+$500.00" or no sign
      - Balance INCREASES
      - Examples: income, deposits, interest
      - Keywords: salary, deposit, credit, interest, transfer in, refund

      Identify withdrawals by:
      1. For 5-column: Withdrawal/Debit column has AMOUNT (not blank, not "-")
      2. For 3-4 column: Amount has "-" prefix/negative number
      3. Balance DECREASED from previous row
      4. Description keywords (purchase, withdrawal, payment, fee)

      âš ï¸ CRITICAL RULES:
      - If Withdrawal/Debit column is BLANK but Deposit/Credit column has value â†’ SKIP!
      - Do NOT extract income/salary transactions - Withdrawal column is blank
      - Do NOT extract interest/refund transactions - Withdrawal column is blank
      - ONLY extract rows where Withdrawal/Debit column has a dollar amount

      Output format (5 FIELDS):

      DOCUMENT_TYPE: BANK_STATEMENT
      STATEMENT_DATE_RANGE: NOT_FOUND
      LINE_ITEM_DESCRIPTIONS: NOT_FOUND
      TRANSACTION_DATES: NOT_FOUND
      TRANSACTION_AMOUNTS_PAID: NOT_FOUND

      Instructions:
      - Statement period: Earliest to latest transaction date (DD/MM/YYYY to DD/MM/YYYY)
      - Transaction descriptions: DEBIT descriptions only, " | " separator
      - Transaction dates: DEBIT dates only, DD/MM/YYYY, " | " separator
      - Amounts paid: Debit amounts with $, " | " separator (money OUT only)
      - VERIFY: No salary/deposit/credit transactions in output
      - Use NOT_FOUND for missing fields

# Use model-specific instructions when appropriate (set by model_name parameter)
use_model_specific_instructions: true

# ============================================================================
# BANK STATEMENT STRUCTURE-SPECIFIC PROMPTS (Phase 2)
# ============================================================================

# Structure-specific extraction prompts based on classified layout
bank_statement_structure_prompts:
  TABLE_3COL_SIMPLE:
    extraction_focus: |
      This bank statement has 3 columns: Date | Description | Amount
      - Extract from single amount column (includes both debits and credits)
      - Identify debits by negative signs or withdrawal indicators

  TABLE_4COL_STANDARD:
    extraction_focus: |
      This bank statement has 4 columns: Date | Description | Debit | Credit
      - Extract ONLY from Debit column (column 3)
      - Skip Credit column entries
      - Debit column is BEFORE Credit column

  TABLE_4COL_REVERSED:
    extraction_focus: |
      This bank statement has REVERSED columns: Date | Description | Credit | Debit
      - CRITICAL: Credit column comes BEFORE Debit column
      - Extract from Debit column (column 4, rightmost before balance)

  TABLE_5COL_STANDARD:
    extraction_focus: |
      This bank statement has 5 columns: Date | Transaction | Debit | Credit | Balance
      - Extract from Debit column (column 3)
      - Use Balance column for validation
      - Running balance helps identify transaction order

  TABLE_5COL_DETAILED:
    extraction_focus: |
      This bank statement has 5 columns with multi-row transactions
      - "Particulars" column may have multiple detail lines
      - Combine multi-line descriptions for same transaction
      - Extract main transaction row debits

  MOBILE_APP_DARK:
    extraction_focus: |
      This is a mobile banking app with dark theme
      - No column headers
      - Transactions grouped under day names (Wed, Thu, etc.)
      - Extract from card-based layout

  MOBILE_APP_LIGHT_INLINE:
    extraction_focus: |
      This is a mobile banking app with inline balance
      - Look for "bal $XXX.XX" text pattern
      - Category labels below descriptions
      - Merchant logos may be present

# Hot reload support
version: "2.0.0"
last_updated: "2025-11-19"
